---
layout: page
title: 99.99 - Coremod
subtitle: Expert modders only!
---

# This is not meant to be a tutorial on writing ASM. If you need a tutorial on that, you shouldn't be reading this.
### This is mostly about how to update coremods from 1.12.2 to 1.13.2

### This is just a draft of the tutorial, more details will be added soon™️

1) `META-INF/coremods.json` [Example](https://github.com/Cadiboo/RenderChunk-rebuildChunk-Hooks/tree/master/src/main/resources/META-INF/coremods.json)
```json
{
	"Transformer 1 Name": "path/to/transformer-1.js",
	"Transformer 2 Name": "path/to/transformer-2.js"
}

```  
2) `transformer.js` [Examples](https://github.com/Cadiboo/RenderChunk-rebuildChunk-Hooks/tree/master/src/main/resources/coremods/)  
3) Basic `transformer.js`: Target class (at time of writing _only_ classes - not methods or fields - can be targeted) and return class node
```javascript
function initializeCoreMod() {
	return {
		'coreModName': {
			'target': {
				'type': 'CLASS',
				'name': 'net.minecraft.client.renderer.chunk.RenderChunk'
			},
			'transformer': function(classNode) {
				// Do stuff with classNode
				return classNode;
			}
		}
	}
}
```  
4) Looping over the methods
```javascript
var methods = classNode.methods;

for (var i in methods) {
	var method = methods[i];
	var methodName = method.name;

	var deobfNameEquals = "rebuildChunk".equals(methodName);
	var mcpNameEquals = "func_178581_b".equals(methodName);

	if (!deobfNameEquals && !mcpNameEquals) {
		print("Did not match method " + methodName);
		continue;
	}

	print("Matched method " + methodName);

	print(deobfNameEquals ? "Matched a deobfuscated name - we are in a DEOBFUSCATED/MCP-NAMED DEVELOPER Environment" : "Matched an SRG name - We are in an SRG-NAMED PRODUCTION Environment")

	// Do stuff with method.instructions

	// Break because this particular coremod only targets one method
	break;
}
```  
5) Using Java classes
```javascript
var Opcodes = Java.type('org.objectweb.asm.Opcodes');
var ASMAPI = Java.type('net.minecraftforge.coremod.api.ASMAPI');
```
See allowed classes at `net.minecraftforge.coremod.CoreModEngine#ALLOWED_CLASSES`  
6) Use `ASMAPI.getMethodNode().instructions` to get a blank `InsnList` because it's not an allowed class for some reason (at the time of writing this, check [here](https://github.com/MinecraftForge/CoreMods/pull/14) for whether this is still the case).  
7) Loop instructions
```javascript
var arrayLength = instructions.size();
for (var i = 0; i < arrayLength; ++i) {
	var instruction = instructions.get(i);
	// Do stuff with instruction
}
```  
8) Debugging  
If the coremod has syntax errors or something check the very top of your log (before anything like `Scanning Mod File:` appears). This is at the very top and is usually to high up for IntelliJ's console to catch it so use the log in `/run/logs/`.  
If the coremod failed to transform properly search for `XFORM` in the log. This will be wherever the class gets initialised so probably towards the end.